<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>9-layer Vertical Farm Stack (scatter â†’ stack)</title>
<style>
    html, body {
    margin: 0;
    overflow-x: hidden;   /* â† ç¦æ­¢å·¦å³æ»šåŠ¨ */
    /* overflow-y: hidden; */
    background: #d5dbe5;
    background-image: url("bg.png");
    background-size: cover;
    background-repeat: no-repeat;
    }
  body {

    display: flex;
    justify-content: center;
    align-items: center;
    height: 220vh;          /* æœ‰æ»šåŠ¨ç©ºé—´ */
    margin: 0;
  }

.wrapper {
    width: 100%;
    position: relative;
    transform: scaleY(0.5);
    transform-origin: bottom center;
    left: 50%;
    top: 550px;
    /* overflow-y: hidden; */
}

  .tray {
    width: 260px;
    height: 260px;
    background: #93a8c7;      /* æµ…ç°è“ */
    border: 5px solid #000;   /* é»‘è¾¹æ¡† */
    border-radius: 22px;
    transform: skewX(-18deg) scaleY(0.85);
    transform-origin: top left;
    position: absolute;
    left: -100px;
    opacity: 0;                /* åˆå§‹ä¸å¯è§ */
    transition: opacity 1s ease;
  }

  .veg-container {
    width: 250px;
    height: 250px;
    transform: skewX(-18deg) scaleY(1);
    position: absolute;
    left: -125px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    padding: 35px;
    box-sizing: border-box;
  }

  .veg {
    font-size: 36px;
    transform: skewX(18deg) scaleY(2);  /* æ¥¼å±‚é‡Œçš„â€œç›´ç«‹â€çŠ¶æ€ */
    transform-origin: center bottom;
    transition: transform 1.2s ease, opacity 1.2s ease;
  }
</style>
</head>
<body>
<div class="wrapper">

  <!-- ====== 1 å±‚ï¼ˆæœ€åº•ï¼‰ top: 400 ====== -->
  <div class="tray" style="top: 400px; z-index: 0;"></div>
  <div class="veg-container" style="top: 400px; z-index: 1;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 2 å±‚ top: 310 ====== -->
  <div class="tray" style="top: 310px; z-index: 2;"></div>
  <div class="veg-container" style="top: 310px; z-index: 3;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 3 å±‚ top: 220 ====== -->
  <div class="tray" style="top: 220px; z-index: 4;"></div>
  <div class="veg-container" style="top: 220px; z-index: 5;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 4 å±‚ top: 130 ====== -->
  <div class="tray" style="top: 130px; z-index: 6;"></div>
  <div class="veg-container" style="top: 130px; z-index: 7;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 5 å±‚ top: 40 ====== -->
  <div class="tray" style="top: 40px; z-index: 8;"></div>
  <div class="veg-container" style="top: 40px; z-index: 9;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 6 å±‚ top: -50 ====== -->
  <div class="tray" style="top: -50px; z-index: 10;"></div>
  <div class="veg-container" style="top: -50px; z-index: 11;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 7 å±‚ top: -140 ====== -->
  <div class="tray" style="top: -140px; z-index: 12;"></div>
  <div class="veg-container" style="top: -140px; z-index: 13;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 8 å±‚ top: -230 ====== -->
  <div class="tray" style="top: -230px; z-index: 14;"></div>
  <div class="veg-container" style="top: -230px; z-index: 15;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

  <!-- ====== 9 å±‚ top: -320ï¼ˆæœ€é¡¶ï¼‰ ====== -->
  <div class="tray" style="top: -320px; z-index: 16;"></div>
  <div class="veg-container" style="top: -320px; z-index: 17;">
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
    <div class="veg">ğŸ¥¬</div><div class="veg">ğŸ¥¦</div><div class="veg">ğŸ¥’</div><div class="veg">ğŸ¥•</div>
    <div class="veg">ğŸŒ¶ï¸</div><div class="veg">ğŸ…</div><div class="veg">ğŸ§…</div><div class="veg">ğŸ§„</div>
  </div>

</div>

<script>
  const trays = document.querySelectorAll('.tray');
  const vegs  = Array.from(document.querySelectorAll('.veg'));

  const baseTransform = 'skewX(18deg) scaleY(2)';

  // è®°å½•æ¯é¢—è”¬èœåœ¨â€œæ¥¼å±‚çŠ¶æ€â€æ—¶çš„ä¸­å¿ƒä½ç½®
  const basePositions = [];

  function collectBasePositions() {
    basePositions.length = 0;
    vegs.forEach(veg => {
      // ç¡®ä¿å…ˆå¤„äºâ€œæ¥¼å±‚çŠ¶æ€â€
      veg.style.transform = baseTransform;
    });

    // ä¸‹ä¸€å¸§æ‹¿ä½ç½®ï¼Œä¿è¯å¸ƒå±€å®Œæˆ
    requestAnimationFrame(() => {
      vegs.forEach(veg => {
        const rect = veg.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top  + rect.height / 2;
        basePositions.push({ x: cx, y: cy });
      });

      // æ‹¿å®Œä½ç½®ä»¥åå†æ•£å¼€
      scatterFromBase();
    });
  }

  function scatterFromBase() {
  const GRID_R = 8;
  const GRID_C = 18;

  const vw = window.innerWidth*1.25;
  const vh = window.innerHeight;

  // ===== è¿™é‡Œæ§åˆ¶â€œæ•£å¸ƒåŒºåŸŸâ€çš„ä½ç½®å’Œå¤§å° =====
  const SCATTER_LEFT   = vw * 0.05;   // ç¦»å·¦è¾¹ 15% å¼€å§‹
  const SCATTER_TOP    = vh * 0.12;   // ç¦»ä¸Šè¾¹ 10% å¼€å§‹
  const SCATTER_WIDTH  = vw * 0.70;   // å®½åº¦å  70% å±å¹•å®½
  const SCATTER_HEIGHT = vh * 0.90;   // é«˜åº¦å  50% å±å¹•é«˜ï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰
  // ======================================

  const spacingX = SCATTER_WIDTH  / (GRID_C + 1);
  const spacingY = SCATTER_HEIGHT / (GRID_R + 1);

  vegs.forEach((veg, index) => {
    const row = Math.floor(index / GRID_C);
    const col = index % GRID_C;

    const targetX = SCATTER_LEFT + (col + 1) * spacingX;
    const targetY = SCATTER_TOP  + (row + 1) * spacingY;

    const base = basePositions[index];
    const dx = targetX - base.x;
    const dy = targetY - base.y;

    veg.style.transform = `${baseTransform} translate(${dx}px, ${dy}px)`;
  });
}


  // åˆå§‹ï¼šè®°å½•æ¥¼å±‚ä½ç½® â†’ æ•£å¼€
  window.addEventListener('load', collectBasePositions);

  let stacked = false;
  let lastScrollY = window.scrollY;

  function stackBack() {
    if (stacked) return;
    stacked = true;

    // æ‰˜ç›˜æ·¡å…¥
    trays.forEach(t => {
      t.style.opacity = '1';
    });

    // è”¬èœå›åˆ°æ¥¼å±‚çŠ¶æ€
    vegs.forEach(veg => {
      veg.style.transform = baseTransform;
    });
  }

  window.addEventListener('scroll', () => {
    const currentY = window.scrollY;

    // å‘ä¸‹æ»šä¸€æ®µè·ç¦»è§¦å‘â€œæ±‡æ‹¢æˆ 9 å±‚â€
    if (!stacked && currentY > lastScrollY && currentY > 300) {
      stackBack();
    }

    lastScrollY = currentY;
  });
</script>
</body>
</html>
